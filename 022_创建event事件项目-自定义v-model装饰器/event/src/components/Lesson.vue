<template>
  <div>
    <!--  -->
    <img :src="lesson.preview" :title="lesson.title" alt="lesson.title" />
    <!-- 失去焦点后还原 @blur="inputShow= false   -->
    <!-- 回车也还原@keyup.enter="inputShow = false" -->
    <!-- <input
        v-if="inputShow"
        type="text"
        v-model="lesson.title"
        @blur="inputShow = false"
        @keyup.enter="inputShow = false"
    />-->
    <!-- 双击事件@dbclick='' -->
    <!-- 传达了一个转大写的事件 -->
    <h2 @dblclick="inputShow = true">
      <input
        v-if="inputShow"
        type="text"
        :value="lesson.title"
        @input="changeToupper"
        @blur="inputShow = false"
        @keyup.enter="inputShow = false"
      />
      <strong v-else>{{ lesson.title }}</strong>
    </h2>
    <!-- 获取 价格 -->
    <h2 @dblclick="inputPriceShow = true">
      <!-- 子的变更信息刷新到父组件 围绕着 modelValue update:modelValue  -->
      <input
        v-if="inputPriceShow"
        type="text"
        :value="lesson.price"
        @input="$emit('update:price', $event.target.value)"
        @blur="inputPriceShow = false"
        @keyup.enter="inputPriceShow = false"
      />
      <strong v-else>{{ lesson.price }}</strong>
    </h2>
    <!-- $attrs控制删除 -->
    <!-- <span v-bind="$attrs" @click="del">✖</span> -->
    <!-- $emit控制删除 -->
    <!-- <span @click="del">✖</span> -->
    <!-- 换成下面的写法 -->
    <span @click="del">✖</span>
  </div>
</template>

<script>
export default {
  /* 接受来自父组件的 数据 v-for取的数据item做事情 */
  /* 默认 注销了 不用父级的触发层 搭配 v-bind="$attrs" 做在子组件的某个标签触发这个方法 */
  // inheritAttrs: false,

  props: ['lesson', 'title', 'price', "titleModifiers",],
  /* 单独触发click事件 自定义触发什么事件 */

  /* 进行事件验证 */
  emits: {
    'update:price': null,
    'update:title': null,

    del(v) {
      console.log(v);
      /* 验证是否是一个数字 */
      if (/^\d+$/.test(v)) {
        // console.log('ok');
        return true
      }
      throw new error('del requires a numeric argument del需要数值参数')
    }
  }
  ,
  data() {

    return {

      inputShow: false,
      inputPriceShow: false,

    }
  },
  /* 生命周期至Vue进阶说明 */
  created() {
    console.log(this.titleModifiers);
  },
  methods: {
    changeToupper(event) {
      console.log(event);
      let capital = event.target.value;
      /* 只限于大写 */
      if (this.titleModifiers.toupper) {
        capital = capital.toUpperCase()
      }
      /* 对象打散为数组,在寻找包含字段 */
      console.log(Object.keys(this.titleModifiers).find(m => /^substr_/.test(m)));
      const substr = Object.keys(this.titleModifiers).find(m => /^substr_/.test(m))
      /* 只限于某些个字段 */
      if (substr) {
        /* 利用下划线_截取 */
        let info = substr.split('_');
        /*打印出来的字段显示在 info[1]的位置 根组件里substr_7 后面数字自己改 */
        capital = capital.substr(0, info[1])
        console.log(info);
      }
      this.$emit('update:title', capital)
  
    },


    del() {
      //  console.log('删除');
      /* 父在子注册的属性对响应式数据props的操作  */
      this.$emit('del', this.lesson.id)
    }
  },
}
</script>

<style lang="scss" scoped>
div {
  border: 1px solid grey;
  text-align: center;
  transition: 1s;
  position: relative;
  &:hover {
    box-shadow: 0 0 20px #aaa;
    > span {
      /* 控制显隐本身就有 渐变的效果 */
      opacity: 1;
      &:hover {
        box-shadow: 0 0 20px rgb(94, 16, 16);
      }
    }
  }

  img {
    width: 100%;
    // height: 80%;
    white-space: wrap;
  }
  h2 {
    padding: 0 0 20px;
    margin: 0;
  }
  span {
    display: block;
    background-color: #555;
    color: #fff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 10px;
    right: 10px;
    line-height: 110%;
    cursor: pointer;
    transition: 1s;
    opacity: 0;
  }
}
</style>